#include <ultra64.h>
#include "common.h"

extern s16 D_803A44D0_7B5B80[];
extern s16 D_803A4500_7B5BB0[];
extern s16 D_803A4530_7B5BE0[];
extern s16 D_803A4544_7B5BF4[];
extern s16 D_803A4574_7B5C24[];
extern s16 D_803A45A4_7B5C54[];
extern s16 D_803A45B8_7B5C68[];
extern s16 D_803A45C8_7B5C78[];
extern s16 D_803A45D8_7B5C88[];
extern s16 D_803A45F4_7B5CA4[];
extern s16 D_803A4630_7B5CE0[];

extern f32 D_803BCA00_7CE0B0;

extern Gfx D_04004090_CBAC0[];
extern Gfx D_04004200_CBC30[];
extern Gfx D_04004330_CBD60[];
extern Gfx D_040046D0_CC100[];
extern Gfx D_040046F0_CC120[];
extern Gfx D_04004D10_CC740[];

extern Gfx D_010037F0_3D0C0[];
extern Gfx D_01003840_3D110[];

s16 func_8037F07C_79072C(s16 arg0, s32 arg1);

// FOX
#if 0
void func_802E5000_6F66B0(void) {
    s16 spC8;
    s16 spC6;
    s16 spC2;
    s16 spBC;
    s16 spBA;
    s16 spB8;
    s16 spB6;
    s16 spB4;
    s16 spB2;
    s16 spAE;
    s16 spAC;
    s16 spAA;
    s16 spA8;
    s16 spA6;
    s16 spA4;
    s16 spA2;
    // u16 sp7C;
    // u16 sp7A;
    // u16 sp78;
    // s32 sp74;
    s32 sp70;
    // s32 sp6C;
    s32 sp68;

    s16 temp_a0_2;
    s16 var_s0;
    u16 temp_a0;

    u16 temp_t5;
    s32 temp_t6;
    s16 temp_v0_6;
    s16 temp_v0_9;
    s16 temp_v1_9;

    u8 var_t0;
    u8 temp_v0_10;

    if (D_803D5538 != 0) {
        if ((D_803D5524->biome == D_803F2D50.segment) ||
            ((D_803D5524->biome == 0) && ((D_803F2D50.segment == 4) || (D_803F2D50.segment == 5)))) {
            var_t0 = 1;
        } else {
            var_t0 = 0;
        }
        if (var_t0 != 0) {
            spC6 = 0;
            D_803F2EDD = 0;
            goto block_9;
        }
    }

    if ((D_803D5524->biome == D_803F2D50.segment) ||
        ((D_803D5524->biome == 0) && ((D_803F2D50.segment == 4) || (D_803F2D50.segment == 5)))) {
        var_t0 = 1;
    } else {
        var_t0 = 0;
    }
    spC6 = func_802E89F0_6FA0A0(D_803D552C->xPos.w, D_803D552C->zPos.w, D_803D552C->yPos.w + (D_803D5524->unkBA << 0xF), 0xCB0, 3, 0x9E, 0x14, 0, 1, var_t0 == 0);
block_9:
    if (spC6 == 0) {
        func_8034B298_75C948(0);
        func_8035D120_76E7D0();
        func_8035D734_76EDE4();

        spA8 = 0;
        spAA = 0;
        switch (D_803D552C->unk365) {
        default:
            D_803D552C->unk365 = 0U;
            break;
        case 42:
            if ((D_803D5530->unk4A != 0) && (D_803F2D10.unk0 == 0)) {
                D_803D552C->unk32A++;
            }
            D_803D5528->unk3C0.unk0 = 0xF;
            D_803D5528->unk3C0.unk2 = 0;

            temp_t5 = (D_803D5544 - D_803D552C->unk32A);
            if (temp_t5 < 9) {
                spAA = temp_t5 * 0x10;
            } else {
                // tbd
                temp_t6 = D_80152C78[(s16)((temp_t5 - 8) << 5) & 0xFF] >> 7;
                spA8 = -temp_t6 >> 3;
                spAA = (temp_t6 >> 4) + 128;
                if (temp_t5 >= 0xE) {
                    D_803D552C->unk32A += 8;
                }
                if ((temp_t5 == 0xA) && (D_803D5530->unk4A == 0)) {
                    if (func_803224C4_733B74(0xF, 0x2A, 0, 0x17, 9, 0, 0, 3) != 0) {
                        play_sound_effect_at_location(0x48, 0x5000, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);
                    } else {
                        play_sound_effect_at_location(0x3B, 0x5000, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);
                    }
                }
            }
            break;
        case 43:
            if (D_803D5530->unk4A != 0) {
                D_803D552C->unk32A++;
            }
            temp_t5 = (D_803D5544 - D_803D552C->unk32A);
            if (temp_t5 < 9) {
                spAA = 0x80 - (temp_t5 * 0x10);
            } else {
                D_803D552C->unk365 = 0;
            }
            break;
        case 20:
            if (D_803D5530->unk4A != 0) {
                D_803D552C->unk32A++;
            }

            temp_a0 = D_803D5544 - D_803D552C->unk32A;
            if (temp_a0 < 9) {
                temp_a0_2 = 32 - (temp_a0 * 2);
                D_803F2EB4 = (temp_a0_2 * D_803F2EB4) >> 5;
                D_803F2EB0 = ((64 - temp_a0_2) * D_803F2EB0) >> 5;
                D_803F2EB8 = ((64 - temp_a0_2) * D_803F2EB8) >> 5;
                if (temp_a0 == 8) {

                    if (D_803D5530->unk4A == 0) {
                        spBC = D_803D5530->xPos.h;
                        spBA = D_803D5530->zPos.h;
                        spB8 = D_803D5530->yPos.h;

                        spC2 = func_8037F07C_79072C(0x180, D_803D552C->unk302);
                        play_sound_effect_at_location(0x6C, 0x5000, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);

                        if (spC2 >= 0x11) {
                            temp_v0_6 = spC2 >> 4;

                            spB6 = (D_803D5530->xPos.h - spBC) / temp_v0_6;
                            spB4 = (D_803D5530->zPos.h - spBA) / temp_v0_6;
                            spB2 = (D_803D5530->yPos.h - spB8) / temp_v0_6;

                            for (var_s0 = temp_v0_6 - 1; var_s0 > 0; var_s0--) {
                                if (spB2 >= (func_8031124C_7228FC(spB6, spB4) >> 0x10)) {
                                    spB2 = (func_8031124C_7228FC(spB6, spB4) >> 0x10);
                                }

                                sp70 = spBC + (var_s0 * spB6);
                                sp68 = spBA + (var_s0 * spB4);

                                create_particle_effect(
                                    sp70,
                                    sp68,
                                    MAX(func_8031124C_7228FC(sp70, sp68) >> 0x10, spB8 + (var_s0 * spB2)) + 6,
                                    21,
                                    0,
                                    0,
                                    0,
                                    0x28,
                                    GPACK_RGBA5551(248, 32, 0, 1),
                                    GPACK_RGBA5551(248, 248, 248, 1),
                                    0);
                            }

                            if (func_80322D68_734418(spBC, spBA, spB8 + D_803D5530->unk42, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h + D_803D5530->unk42, &spA6, &spA4, &spA2, 0x14, 0xA, 1, 0)) {
                                play_sound_effect_at_location(72, 0x5000, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);

                                for (var_s0 = 0; var_s0 < 4; var_s0++) {
                                    create_particle_effect(
                                        spA6,
                                        spA4,
                                        spA2,
                                        0x18,
                                        (SSSV_RAND(16) - 7) << 0x10,
                                        (SSSV_RAND(16) - 7) << 0x10,
                                        SSSV_RAND(16) << 0x10,
                                        SSSV_RAND(4) + 4,
                                        GPACK_RGBA5551(248, 32, 0, 1),    // red
                                        GPACK_RGBA5551(248, 248, 248, 1), // white
                                        0);
                                }
                            }
                        }
                    }
                }
            } else if (temp_a0 < 0x10) {
                D_803F2EB4 = (temp_a0 * D_803F2EB4) >> 5;
                temp_v0_9 = 0x40 - (((temp_a0 - 8) * 2) + 0x10);
                D_803F2EB0 = (temp_v0_9 * D_803F2EB0) >> 5;
                D_803F2EB8 = (temp_v0_9 * D_803F2EB8) >> 5;
            } else {
                D_803D552C->unk365 = 0;
                func_8033F300_7509B0();
            }
            break;
        }
        if ((D_803F2ECE == 0) || (D_803F2ECC < 0x1F)) {
            func_802B9130_6CA7E0(&spC8, 0x186, 0x96, 0x1F4, 0x64);
            func_802BF3C0_6D0A70(0x1F4, 0x64, 0, 0x80, 0, 0x80, &D_803A44D0_7B5B80, &D_803A4500_7B5BB0, &D_803A4530_7B5BE0, 0x1F4, 0x64, 0, 0x80, 0x80, 0, &D_803A4544_7B5BF4, &D_803A4574_7B5C24, &D_803A45A4_7B5C54, &spC8);
            func_802B964C_6CACFC();
            func_802C4A70_6D6120(0x258, 0x190, 0);
            func_802BBC90_6CD340(0x366);
            func_803033D4_714A84(0x1A, 2, spA8);
            func_8034B3A8_75CA58(0);
            func_8038CCF0_79E3A0(0xC8, 0x14, -1, -1, -1, -1);
        }
        if (D_803F2ECC != 0) {
            func_802DB8DC_6ECF8C();
            switch (D_803F2ECE) {
            case 1:
                func_802DB670_6ECD20(D_803A45B8_7B5C68, D_803A45C8_7B5C78, D_803A45D8_7B5C88, D_803A45F4_7B5CA4);
                break;
            case 2:
                func_802DB670_6ECD20(D_803A45B8_7B5C68, D_803A45C8_7B5C78, D_803A45D8_7B5C88, D_803A4630_7B5CE0);
                break;
            }
        }
        func_8038064C_791CFC();

        if (((D_80204278->usedModelViewMtxs + 30) < 250) && (D_803F2EDA != 0) && ((D_803D5538 != 0) || (temp_v0_10 = D_803F2AA2, (temp_v0_10 == 0)) || (temp_v0_10 == 2) || ((temp_v0_10 == 1) && (D_803F2AA3 >= 0xB))) && ((D_803F2C18[0] != 0) || (D_803D5538 == 0) || ((D_803F28E0[D_803F2A98].cameraMode != 3) && (D_803F28E0[D_803F2A98].cameraMode != 0x11)) || (D_803F28E0[D_803F2A98].unk64 != -3))) {
            func_80127640(&D_80204278->modelViewMtx[D_80204278->usedModelViewMtxs], D_803D5530->xPos.w, D_803D5530->zPos.w, D_803D5530->yPos.w, (spAA - D_803D552C->unk302) & 0xFF, D_803F2EB0 / 4, D_803F2EB4 / 4, D_803F2EB8 / 4, D_803F2ED2, D_803F2ED4);

            gSPMatrix(D_801D9E88++, OS_K0_TO_PHYSICAL(&D_80204278->modelViewMtx[D_80204278->usedModelViewMtxs++]), G_MTX_PUSH | G_MTX_MUL | G_MTX_MODELVIEW);

            func_8038C230_79D8E0((D_803D5524->unkBA * 8) / 5, 2, 3, 3, 0.22f); // D_803BCA00_7CE0B0
            func_802C78B0_6D8F60(1, 20, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, D_803F2ED0, 0, 0, 0, D_04004D10_CC740);
            func_802C78B0_6D8F60(1,  2, FTOFIX32(0.90625), FTOFIX32(0.90625), FTOFIX32(0.90625), D_803F2ED0, 0, 0, 0, D_04004090_CBAC0);
            func_802C78B0_6D8F60(2, 26, FTOFIX32(0.90625), FTOFIX32(0.90625), FTOFIX32(0.90625), D_803F2ED0, 0, 0, 0, D_04004200_CBC30);
            if (D_803F2EDD == 0) { func_802C78B0_6D8F60(3, 7, FTOFIX32(0.90625), FTOFIX32(0.90625), FTOFIX32(0.90625), D_803F2ED0, 0, 0, 0, D_04004330_CBD60); }
            if (D_803F2EDD == 0) { func_802C78B0_6D8F60(5, 13, FTOFIX32(0.90625), FTOFIX32(0.90625), FTOFIX32(0.90625), D_803F2ED0, 0, 0, 0, D_04004330_CBD60); }

            gSPClearGeometryMode(D_801D9E88++, G_CULL_BACK);
            gSPSetGeometryMode(D_801D9E88++, G_CULL_FRONT);

            if (D_803F2EDD == 0) { func_802C78B0_6D8F60(4, 10, FTOFIX32(0.90625), FTOFIX32(0.90625), FTOFIX32(0.90625), D_803F2ED0, 0, 1, 0, D_04004330_CBD60); }
            if (D_803F2EDD == 0) { func_802C78B0_6D8F60(6, 16, FTOFIX32(0.90625), FTOFIX32(0.90625), FTOFIX32(0.90625), D_803F2ED0, 0, 1, 0, D_04004330_CBD60); }
            if (D_803F2EDD == 0) {
                func_8031A150_72B800(D_803D552C->unk326++, &spAE, &spAC);
                func_8031A278_72B928(&D_803D552C->unk326, &spAE, &spAC);
                spAE = D_803BD5B2_7CEC62[spAE]; spAC = D_803BD66A_7CED1A[spAC];

                func_80356BD8_768288(&D_01000CA0, &D_01002100, spAE);
                gSPDisplayList(D_801D9E88++, &D_010037F0_3D0C0);

                func_802C78B0_6D8F60(1, 0x14, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, D_803F2ED0, 0, 0, 0, D_040046D0_CC100);
                func_80356BD8_768288(&D_01000CA0, &D_01002100, spAC);
                func_802C78B0_6D8F60(1, 0x14, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, D_803F2ED0, 0, 0, 0, D_040046F0_CC120);
                gSPDisplayList(D_801D9E88++, D_01003840_3D110);
            }
            gSPPopMatrix(D_801D9E88++, G_MTX_MODELVIEW);
        }
        func_8035D6A0_76ED50();
    } else {
        func_8035D6D0_76ED80();
    }
    if ((spC6 == 0) || (spC6 == 2)) {
        func_8034BD20_75D3D0(D_803D552C->xPos.h, D_803D552C->zPos.h, D_803D552C->yPos.h + D_803D5524->unkBA, (D_803D552C->unk302 - spAA) & 0xFF, &D_01033190, 0x25, 9, 0x9B, 0, 0, 0, 0, D_803D5538);
    }
    if (spC6 == 0) {
        func_803034D0_714B80(D_803D552C, 0x30C, 0, 1);
        func_80303990_715040(D_803D552C, 1, 33, 1, 20, 0x190, 0);
        func_80303D50_715400(D_803D552C, 3);
    } else {
        func_80303D00_7153B0(D_803D552C, 0x492, 0x1F4);
    }

    if (D_803D5538 == 0) {
        if (D_803D552C->unk2EC <= 0) {
            if (D_803D552C->unk365 == 0x2A) {
                D_803D552C->unk365 = 0x2B;
                D_803D552C->unk32A = D_803D5544;
            }
        } else {
            D_803D552C->unk2EC--;
        }
    }
}
#else
#pragma GLOBAL_ASM("asm/nonmatchings/sssv/animals/fox/func_802E5000_6F66B0.s")
#endif

extern f64 D_803BCA08_7CE0B8; // 0.7111111111111111
extern f64 D_803BCA10_7CE0C0; // 32767.0
extern f64 D_803BCA18_7CE0C8; // 0.4
extern f64 D_803BCA20_7CE0D0; // 0.6
extern f32 D_803BCA28_7CE0D8; // 0.22

extern s16 D_803A4750_7B5E00[];
extern s16 D_803A4758_7B5E08[];
extern s16 D_803A4760_7B5E10[];
extern s16 D_803A476C_7B5E1C[];
extern s16 D_803A4788_7B5E38[];

extern Gfx D_040046F0_CC120[];
extern Gfx D_04004A20_CC450[];
extern Gfx D_04005030_CCA60[];
extern Gfx D_040050D0_CCB00[];
extern Gfx D_040052D0_CCD00[];

// FIRE_FOX
#if 0
// miles away
void func_802E620C_6F78BC(void) {
    s16 sp98;
    s16 sp92;
    s16 sp8E;
    s16 sp8C;

    f32 var_f12;

    f32 var_f0;
    s16 var_v1;
    s16 var_v0;
    s16 var_v0_3;

    u8 temp_v0_5;

    if (D_803D5538 != 0) {
        if ((D_803D5524->biome == D_803F2D50.segment) ||
            ((D_803D5524->biome == 0) && ((D_803F2D50.segment == 4) || (D_803F2D50.segment == 5)))) {
            var_v0 = 1;
        } else {
            var_v0 = 0;
        }
        if (var_v0 != 0) {
            sp98 = 0;
            D_803F2EDD = 0;
            goto block_9;
        }
    }
    if ((D_803D5524->biome == D_803F2D50.segment) ||
        ((D_803D5524->biome == 0) && ((D_803F2D50.segment == 4) || (D_803F2D50.segment == 5)))) {
        var_v0 = 1;
    } else {
        var_v0 = 0;
    }
    sp98 = func_802E89F0_6FA0A0(D_803D552C->xPos.w, D_803D552C->zPos.w, D_803D552C->yPos.w + (D_803D5524->unkBA << 0xF), 0xFDC, 3, 0x9E, 0x14, 0, 1, var_v0 == 0);

block_9:
    if ((sp98 != 4) && (sp98 != 1)) {
        // D_803BCA08_7CE0B8
        var_f0 = (f32) (((D_803F2C3C * 0.7111111111111111) - D_803D5530->yRotation) - 64.0);

        while (var_f0 < -128.0) { var_f0 += 256.0; };
        while (var_f0 > 128.0) { var_f0 -= 256.0; }

        if (var_f0 < 0.0f) {
            var_f0 = -var_f0;
        }

        var_f12 = 1.0f;
        if (D_803D5538 != 0) {
            var_f12 = (D_803D554C * 0.0625) + 1;
        }
        if (D_803D552C->unk365 == 0x2F) {
            var_f12 += (func_8012826C() - 32768.0) / 65536.0;
        }

        // D_803BCA10_7CE0C0, D_803BCA20_7CE0D0, D_803BCA18_7CE0C8,
        var_v0_3 = MIN(32767.0, (28672.0f * var_f12) * (0.6 + (0.4 * var_f0 * 0.0078125)));

        if ((D_803D552C->unk366 == 2) || (D_803D552C->unk366 == 5)) {
            var_v0_3 = MAX(0, var_v0_3 - ((D_803D5544 - D_803D552C->unk328) << 9));
        }
        if ((D_803D5538 != 0) || (D_803F2D50.segment != 0)) {
            func_8032CED0_73E580(
                D_803D5530,
                0x67,
                var_v0_3,
                0.3f, // 0.30000001192092896f
                0,
                D_803D5538,
                D_803D552C->xPos.h,
                D_803D552C->zPos.h,
                D_803D552C->yPos.h,
                D_803D552C->xVelocity.w,
                D_803D552C->zVelocity.w,
                D_803D552C->yVelocity.w);
        }
    }
    if (sp98 == 0) {
        func_8037FE24_7914D4();
        func_8035D120_76E7D0();
        func_8035D734_76EDE4();
        // temp_v1_4 = D_803D552C;
        if ((D_803D552C->unk365 == 0x2F) && (((D_803D5544 - D_803D552C->unk32A) & 0xFFFF) >= 0x33)) {
            D_803D552C->unk365 = 0U;
        }
        if ((D_803F2ECE == 0) || (D_803F2ECC < 31)) {
            func_802BAA38_6CC0E8(0x186, 0x96);
            func_802C4A70_6D6120(0x258, 0x190, 0);
            func_802BBA10_6CD0C0(0x366);
        }
        if (D_803F2ECC != 0) {
            func_802DB8DC_6ECF8C();
            switch (D_803F2ECE) {
            case 1:
                func_802DB670_6ECD20(D_803A4750_7B5E00, D_803A4758_7B5E08, D_803A4760_7B5E10, D_803A476C_7B5E1C);
                break;
            case 2:
                func_802DB670_6ECD20(D_803A4758_7B5E08, D_803A4758_7B5E08, D_803A4760_7B5E10, D_803A4788_7B5E38);
                break;
            }
        }

        func_8038064C_791CFC();
        if (((D_80204278->usedModelViewMtxs + 30) < 250) && (D_803F2EDA != 0) && (((D_803D5538 != 0)) || (temp_v0_5 = D_803F2AA2, (temp_v0_5 == 0)) || (temp_v0_5 == 2) || ((temp_v0_5 == 1) && ((s32) D_803F2AA3 >= 0xB))) && ((D_803F2C18[0] != 0) || (D_803D5538 == 0) || ((D_803F28E0[D_803F2A98].cameraMode != 3) && (D_803F28E0[D_803F2A98].cameraMode != 0x11)) || (D_803F28E0[D_803F2A98].unk64 != -3))) {
            func_80127640(&D_80204278->modelViewMtx[D_80204278->usedModelViewMtxs], D_803D5530->xPos.w, D_803D5530->zPos.w, D_803D5530->yPos.w, (s32) -D_803D5530->yRotation, (s32) D_803F2EB0 / 4, (s32) D_803F2EB4 / 4, (s32) D_803F2EB8 / 4, (s32) D_803F2ED2, D_803F2ED4);
            gSPMatrix(D_801D9E88++, OS_K0_TO_PHYSICAL(&D_80204278->modelViewMtx[D_80204278->usedModelViewMtxs++]), G_MTX_PUSH | G_MTX_MUL | G_MTX_MODELVIEW);

            // D_803BCA28_7CE0D8
            func_8038C230_79D8E0((D_803D5524->unkBA * 8) / 5, 2, 3, 3, 0.22f);
            func_802C78B0_6D8F60(1, 20, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, D_803F2ED0, 0, 0, 0, &D_04004D10_CC740);
            func_802C78B0_6D8F60(1, 2, FTOFIX32(0.90625), FTOFIX32(0.90625), FTOFIX32(0.90625), D_803F2ED0, 0, 0, 0, &D_04004090_CBAC0);
            if (D_803F2EDD == 0) {
                func_802C78B0_6D8F60(
                    2,
                    1,
                    ((((D_803D552C->missileScaleLeft + 8) * D_803F2EBC) >> 4) * 0x3A) >> 6,
                    ((((D_803D552C->missileScaleLeft + 8) * D_803F2EC0) >> 4) * 0x3A) >> 6,
                    ((((D_803D552C->missileScaleLeft + 8) * D_803F2EC4) >> 4) * 0x3A) >> 6,
                    D_803F2ED0,
                    0,
                    0,
                    0,
                    &D_04005030_CCA60);
            }
            if ((D_803F2ECE != 1) || (D_803F2ECC == 0)) {
                load_1_tile(&D_040052D0_CCD00, &D_040050D0_CCB00);
                if (D_803F2D10.unk0 != 0) {
                    func_802C78B0_6D8F60(2, 0x1A, FTOFIX32(1.1328125), FTOFIX32(1.1328125), FTOFIX32(1.1328125), D_803F2ED0, 0, 0, 0, &D_04004A20_CC450);
                } else if (D_803D5538 != 0) {
                    func_802C78B0_6D8F60(
                        2,
                        0x1A,
                        (((((SSSV_RAND(256) << 7) + FTOFIX32(1.0)) * (D_803D554C + 0x10)) >> 4) * 0x3A) >> 6,
                        (((((SSSV_RAND(256) << 7) + FTOFIX32(1.0)) * (D_803D554C + 0x10)) >> 4) * 0x3A) >> 6,
                        (((((SSSV_RAND(256) << 7) + FTOFIX32(1.0)) * (D_803D554C + 0x10)) >> 4) * 0x3A) >> 6,
                        D_803F2ED0,
                        0,
                        0,
                        0,
                        &D_04004A20_CC450);
                } else {
                    func_802C78B0_6D8F60(
                        2,
                        0x1A,
                        ((SSSV_RAND(256) * 0xE80 * 2) + FTOFIX32(58.0)) >> 6,
                        ((SSSV_RAND(256) * 0xE80 * 2) + FTOFIX32(58.0)) >> 6,
                        ((SSSV_RAND(256) * 0xE80 * 2) + FTOFIX32(58.0)) >> 6,
                        D_803F2ED0,
                        0,
                        0,
                        0,
                        &D_04004A20_CC450);
                }
            }
            if (D_803F2EDD == 0) {
                func_8031A150_72B800(D_803D552C->unk326++, &sp8E, &sp8C);
                func_8031A278_72B928(&D_803D552C->unk326, &sp8E, &sp8C);
                sp8E = D_803BD5B2_7CEC62[sp8E];sp8C = D_803BD66A_7CED1A[sp8C]; // * 2));
                func_80356BD8_768288(&D_01000CA0, &D_01002100, sp8E);
                gSPDisplayList(D_801D9E88++, &D_010037F0_3D0C0);

                func_802C78B0_6D8F60(1, 0x14, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, D_803F2ED0, 0, 0, 0, &D_040046D0_CC100);
                func_80356BD8_768288(&D_01000CA0, &D_01002100, sp8C);
                func_802C78B0_6D8F60(1, 0x14, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, D_803F2ED0, 0, 0, 0, &D_040046F0_CC120);
                gSPDisplayList(D_801D9E88++, &D_01003840_3D110);
            }
            gSPPopMatrix(D_801D9E88++, G_MTX_MODELVIEW);

            if ((D_803F2ECE != 1) || (D_803F2ECC == 0)) {
                create_particle_effect(
                    D_803D5530->xPos.h + (((D_80152C78[-D_803D552C->unk302 & 0xFF] >> 7) * 1560) / 14848),
                    D_803D5530->zPos.h - (((D_80152C78[(D_803D552C->unk302 + 0x40) & 0xFF] >> 7) * 1560) / 14848),
                    D_803D5530->yPos.h + 8,
                    SSSV_RAND(2) + 25, // pick 1 of 2 particles
                    (SSSV_RAND(32768) * 2) + FTOFIX32(-0.6103515625),
                    (SSSV_RAND(32768) * 2) + FTOFIX32(-0.6103515625),
                    0,
                    SSSV_RAND(16),
                    GPACK_RGBA5551(0, 0, 0, 1),
                    GPACK_RGBA5551(0, 0, 0, 1),
                    SSSV_RAND(32) + 0x19);

                if ((D_803D5538 != 0) && (D_803D554C >= 9)) {
                    var_v1 = SSSV_RAND(2);
                } else {
                    var_v1 = SSSV_RAND(4);
                }
                if (var_v1 == 0) {
                    if (D_803D5538 != 0) {
                        sp92 = D_803D554C;
                    } else {
                        sp92 = 0;
                    }

                    create_particle_effect(
                        D_803D5530->xPos.h + (((D_80152C78[-D_803D552C->unk302 & 0xFF] >> 7) * 0x618) / 14848),
                        D_803D5530->zPos.h - (((D_80152C78[(D_803D552C->unk302 + 0x40) & 0xFF] >> 7) * 0x618) / 14848),
                        D_803D5530->yPos.h + 8,
                        SSSV_RAND(2) + 25,
                        SSSV_RAND(32768) * 2,
                        SSSV_RAND(32768) * 2,
                        0,
                        SSSV_RAND(16) + sp92,
                        GPACK_RGBA5551(0, 0, 0, 1),
                        GPACK_RGBA5551(0, 0, 0, 1),
                        SSSV_RAND(32) + 0x19);
                }
            }
        }
        func_8035D6A0_76ED50();
    } else {
        func_8035D6D0_76ED80();
    }
    if ((sp98 == 0) || (sp98 == 2)) {
        func_8034BD20_75D3D0(D_803D552C->xPos.h, D_803D552C->zPos.h, (D_803D552C->yPos.h + D_803D5524->unkBA), D_803D552C->unk302, &D_01033190, 0x25, 9, 0x9B, 0, 0, 0, 0, D_803D5538);
    }
    if (sp98 == 0) {
        func_803034D0_714B80(D_803D552C, 0x30C, 0, 1);
        func_80303820_714ED0(D_803D552C, 1, 0x14, 0x190, 0);
        func_80303D50_715400(D_803D552C, 3);
    } else {
        func_80303D00_7153B0(D_803D552C, 0x492, 0x1F4);
    }
}
#else
#pragma GLOBAL_ASM("asm/nonmatchings/sssv/animals/fox/func_802E620C_6F78BC.s")
#endif

extern s16 D_803A466C_7B5D1C[];
extern s16 D_803A4680_7B5D30[];
extern s16 D_803A4694_7B5D44[];
extern s16 D_803A46B8_7B5D68[];
extern s16 D_803A4704_7B5DB4[];


extern f64 D_803BCA30_7CE0E0; // 0.2
extern f64 D_803BCA38_7CE0E8; // 0.6
extern f32 D_803BCA40_7CE0F0; // 0.22f

extern Gfx D_04004590_CBFC0[];
// RACING_FOX
#if 0
void func_802E7394_6F8A44(void) {
    struct086 spB0;
    s16 spAE;
    s16 spAA;
    s16 spA8;
    s16 spA6;
    s16 spA4;
    s16 spA2;
    s16 spA0;
    s16 sp9E;
    s16 sp9A;
    s16 sp98;
    s16 sp94;
    s16 sp92;
    s32 sp64;
    s32 sp60;
    s32 sp5C;
    s32 sp4C;

    f32 var_f0;
    f32 temp_f2_2;
    s16 temp_a0_3;
    s16 temp_a2;
    s16 temp_v0_9;
    s16 temp_v1_8;
    s16 var_s0;
    s32 temp_a1_2;
    u16 temp_t3;
    s32 temp_t4;
    s32 temp_v0_10;
    s32 temp_v0_8;
    s32 temp_v1_9;
    u8 var_t0;
    u8 temp_a0_4;
    u8 temp_v0_11;

    if (D_803D5538 != 0) {
        if ((D_803D5524->biome == D_803F2D50.segment) || ((D_803D5524->biome == 0) && ((D_803F2D50.segment == 4) || (D_803F2D50.segment == 5)))) {
            var_t0 = 1;
        } else {
            var_t0 = 0;
        }
        if (var_t0 != 0) {
            spAE = 0;
            D_803F2EDD = 0;
            goto block_9;
        }
    }

    if ((D_803D5524->biome == D_803F2D50.segment) || ((D_803D5524->biome == 0) && ((D_803F2D50.segment == 4) || (D_803F2D50.segment == 5)))) {
        var_t0 = 1;
    } else {
        var_t0 = 0;
    }
    spAE = func_802E89F0_6FA0A0(D_803D552C->xPos.w, D_803D552C->zPos.w, D_803D552C->yPos.w + (D_803D5524->unkBA << 0xF), 0xCB0, (u8) 3, (s16) 0x9E, (s16) 0x14, (s16) 0, (s8) 1, (u8) (var_t0 == 0));

block_9:
    if ((spAE != 4) && (spAE != 1) && (D_803D5530->unk162 == 1)) {

        temp_f2_2 = (sqrtf(((f32)D_803D552C->xVelocity.w * D_803D552C->xVelocity.w) + ((f32)D_803D552C->zVelocity.w * D_803D552C->zVelocity.w)) / (f32) (D_803D5524->unkA4 << 0xA));
        // temp_f14 = D_803BCA30_7CE0E0;
        if (temp_f2_2 < 0.2) {
            var_f0 = 0.0f;
        } else if (0.6 < temp_f2_2) {
            var_f0 = 1.0f;
        } else {
            var_f0 = ((temp_f2_2 - 0.2) * 2.5);
        }
        if (var_f0 > 0.0) {
            if (D_803D5530->unk4A == 0) {
                func_8032CED0_73E580(D_803D5530, 0xD, (s16) (s32) ((f64) (12288.0f * var_f0) * 0.5), (f32) (2.0 * temp_f2_2), (s16) 0, (s16) (s32) D_803D5538, (s16) (s32) D_803D552C->xPos.h, (s16) (s32) D_803D552C->zPos.h, (s16) (s32) D_803D552C->yPos.h, (s16) D_803D552C->xVelocity.w, (s16) D_803D552C->zVelocity.w, (s16) D_803D552C->yVelocity.w);
            }
        }
    }
    if (spAE == 0) {
        func_8034B298_75C948(0);
        func_8035D120_76E7D0();
        func_8035DA60_76F110();
        func_8035D734_76EDE4();
        sp98 = 0;
        sp9A = 0;
        switch (D_803D552C->unk365) {                        /* irregular */
        default:
            D_803D552C->unk365 = 0;
            break;
        case 42:
            if ((D_803D5530->unk4A != 0) && (D_803F2D10.unk0 == 0)) {
                D_803D552C->unk32A += 1;
            }
            D_803D5528->unk3C0.unk0 = 0xF;
            D_803D5528->unk3C0.unk2 = 0;

            temp_t3 = (D_803D5544 - D_803D552C->unk32A); // & 0xFFFF;
            if (temp_t3 < 9) {
                sp9A = temp_t3 * 0x10;
            } else {
                temp_t4 = D_80152C78[(s16)((temp_t3 - 8) << 5) & 0xFF] >> 7;
                sp98 = (s16) ((s32) -temp_t4 >> 3);
                sp9A = (temp_t4 >> 4) + 0x80;
                if (temp_t3 >= 0xE) {
                    D_803D552C->unk32A = D_803D552C->unk32A + 8;
                }
                if ((temp_t3 == 0xA) && (D_803D5530->unk4A == 0)) {
                    if (func_803224C4_733B74(0xF, 0x2A, 0, 0x17, (s16) 9, (s16) 0, (s16) 0, (u8) 3) != 0) {
                        // temp_v1_3 = D_803D5530;
                        play_sound_effect_at_location(0x48, 0x5000, 0, D_803D5530->xPos.h, (s16) (s32) D_803D5530->zPos.h, (s16) (s32) D_803D5530->yPos.h, 1.0f);
                    } else {
                        // temp_v1_4 = D_803D5530;
                        play_sound_effect_at_location(0x3B, 0x5000, 0, D_803D5530->xPos.h, (s16) (s32) D_803D5530->zPos.h, (s16) (s32) D_803D5530->yPos.h, 1.0f);
                    }
                }
            }
            break;
        case 43:
            if (D_803D5530->unk4A != 0) {
                D_803D552C->unk32A += 1;
            }
            temp_t3 = (D_803D5544 - D_803D552C->unk32A); // & 0xFFFF;
            if (temp_t3 < 9) {
                sp9A = 0x80 - (temp_t3 * 0x10);
            } else {
                D_803D552C->unk365 = 0;
            }
            break;
        case 20:
            if (D_803D5530->unk4A != 0) {
                D_803D552C->unk32A += 1;
            }
            temp_t3 = D_803D5544 - D_803D552C->unk32A;
            // temp_t6 = temp_a0_2 & 0xFFFF;
            if (temp_t3 < 0x11) {
                temp_a0_3 = 0x20 - temp_t3;
                temp_a1_2 = 0x40 - temp_a0_3;
                D_803F2EB4 = (s32) (temp_a0_3 * D_803F2EB4) >> 5;
                D_803F2EB0 = (s32) (temp_a1_2 * D_803F2EB0) >> 5;
                D_803F2EB8 = (s32) (temp_a1_2 * D_803F2EB8) >> 5;
                if (temp_t3 == 0x10) {
                    // temp_v1_5 = D_803D5530;
                    if (D_803D5530->unk4A == 0) {
                        spA8 = D_803D5530->xPos.h;
                        spA6 = D_803D5530->zPos.h;
                        spA4 = D_803D5530->yPos.h;
                        // temp_v1_6 = D_803D5530;
                        spAA = func_8037F07C_79072C(0x180, D_803D552C->unk302);
                        play_sound_effect_at_location(0x6C, 0x5000, 0, D_803D5530->xPos.h, (s16) (s32) D_803D5530->zPos.h, (s16) (s32) D_803D5530->yPos.h, 1.0f);
                        temp_v0_8 = spAA >> 4;
                        if (spAA >= 0x11) {
                            // temp_v1_7 = D_803D5530;
                            temp_a2 = (s16) temp_v0_8 - 1;
                            sp9E = (s16) ((s32) (D_803D5530->yPos.h - spA4) / (s16) temp_v0_8);
                            var_s0 = temp_a2;
                            if (temp_a2 > 0) {
                                spA2 = (s16) ((s32) (D_803D5530->xPos.h - spA8) / (s16) temp_v0_8);
                                spA0 = (s16) ((s32) (D_803D5530->zPos.h - spA6) / (s16) temp_v0_8);
                                do {
                                    if (sp9E >= (func_8031124C_7228FC(spA2, spA0) >> 0x10)) {
                                        sp9E = (s16) (func_8031124C_7228FC(spA2, spA0) >> 0x10);
                                    }
                                    temp_v0_9 = spA8 + (var_s0 * spA2);
                                    sp60 = (s32) temp_v0_9;
                                    sp64 = (s32) temp_v0_9;
                                    temp_v1_8 = spA6 + (var_s0 * spA0);
                                    sp4C = (s32) temp_v1_8;
                                    sp5C = (s32) temp_v1_8;

                                    var_t0 = MAX(func_8031124C_7228FC((s16) sp60, (s16) sp4C) >> 0x10, spA4 + (var_s0 * sp9E));
                                    create_particle_effect(
                                        sp64,
                                        sp5C,
                                        var_t0 + 6,
                                        0x15,
                                        0,
                                        0,
                                        0,
                                        0x28,
                                        0xF901,
                                        0xFFFF,
                                        0);
                                    var_s0 -= 1;
                                } while (var_s0 > 0);
                            }
                        }
                    }
                }
            } else if (temp_t3 < 0x20) {
                temp_v0_10 = 0x40 - temp_t3;
                D_803F2EB4 = (temp_t3 * D_803F2EB4) >> 5;
                D_803F2EB0 = (temp_v0_10 * D_803F2EB0) >> 5;
                D_803F2EB8 = (temp_v0_10 * D_803F2EB8) >> 5;
            } else {
                D_803D552C->unk365 = 0;
                func_8033F300_7509B0();
            }
            break;
        }
        if ((D_803F2ECE == 0) || ((s32) D_803F2ECC < 0x1F)) {
            func_802B9130_6CA7E0(&spB0, 0x186, 0x96, 0x1F4, (s16) 0);
            func_802C1830_6D2EE0(0x190U, (struct061 *) &spB0);
            func_802B964C_6CACFC();
            func_802C4A70_6D6120(0x258, 0x190, 0);
            func_802BBC90_6CD340(0x366);
            func_803033D4_714A84(0x1A, 2, sp98);
            func_8034B3A8_75CA58(0);
            func_8038CCF0_79E3A0(0xC8, 0x14, -1, -1, (s16) -1, (s16) -1);
        }
        if (D_803F2ECC != 0) {
            func_802DB8DC_6ECF8C();
            // temp_t0_3 = D_803F2ECE;
            switch (D_803F2ECE) {                    /* switch 1; irregular */
            case 1:                                 /* switch 1 */
                func_802DB670_6ECD20(&D_803A466C_7B5D1C, &D_803A4680_7B5D30, &D_803A4694_7B5D44, &D_803A46B8_7B5D68);
                break;
            case 2:                                 /* switch 1 */
                func_802DB670_6ECD20(&D_803A466C_7B5D1C, &D_803A4680_7B5D30, &D_803A4694_7B5D44, &D_803A4704_7B5DB4);
                break;
            }
        }
        func_8038064C_791CFC();
        if (((D_80204278->usedModelViewMtxs + 0x1E) < 0xFA) && (D_803F2EDA != 0) && ((temp_a0_4 = D_803D5538, (temp_a0_4 != 0)) || (temp_v0_11 = D_803F2AA2, (temp_v0_11 == 0)) || (temp_v0_11 == 2) || ((temp_v0_11 == 1) && ((s32) D_803F2AA3 >= 0xB))) && ((D_803F2C18[0] != 0) || (temp_a0_4 == 0) || ((D_803F28E0[D_803F2A98].cameraMode != 3) && (D_803F28E0[D_803F2A98].cameraMode != 0x11)) || (D_803F28E0[D_803F2A98].unk64 != -3))) {
            func_80127640(&D_80204278->modelViewMtx[D_80204278->usedModelViewMtxs], (u32) D_803D5530->xPos.w, (u32) D_803D5530->zPos.w, (u32) D_803D5530->yPos.w, (s16) ((sp9A - D_803D552C->unk302) & 0xFF), (s32) D_803F2EB0 / 4, (s32) D_803F2EB4 / 4, (u32) ((s32) D_803F2EB8 / 4), (s16) (s32) D_803F2ED2, D_803F2ED4);
            gSPMatrix(D_801D9E88++, OS_K0_TO_PHYSICAL(&D_80204278->modelViewMtx[D_80204278->usedModelViewMtxs++]), G_MTX_PUSH | G_MTX_MUL | G_MTX_MODELVIEW);

            func_8038C230_79D8E0((D_803D5524->unkBA * 8) / 5, 2, 3, 3, D_803BCA40_7CE0F0);
            func_802C78B0_6D8F60(1, 20, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, D_803F2ED0, 0, 0, 0, D_04004D10_CC740);
            func_802C78B0_6D8F60(1, 2,   0xE800, 0xE800, 0xE800, D_803F2ED0, 0, 0, 0, D_04004090_CBAC0);
            func_802C78B0_6D8F60(2, 26,  0xE800, 0xE800, 0xE800, D_803F2ED0, 0, 0, 0, D_04004200_CBC30);
            func_802C78B0_6D8F60(7, 8,   0xE800, 0xE800, 0xE800, D_803F2ED0, 0, 0, 0, D_04004590_CBFC0);
            func_802C78B0_6D8F60(10, 11, 0xE800, 0xE800, 0xE800, D_803F2ED0, 0, 0, 0, D_04004590_CBFC0);
            func_802C78B0_6D8F60(13, 14, 0xE800, 0xE800, 0xE800, D_803F2ED0, 0, 0, 0, D_04004590_CBFC0);
            func_802C78B0_6D8F60(16, 17, 0xE800, 0xE800, 0xE800, D_803F2ED0, 0, 0, 0, D_04004590_CBFC0);
            if (D_803F2EDD == 0) {
                func_8031A150_72B800(D_803D552C->unk326++, &sp94, &sp92);
                func_8031A278_72B928(&D_803D552C->unk326, (s16 *) &sp94, (s16 *) &sp92);
                sp94 = D_803BD5B2_7CEC62[sp94];sp92 = D_803BD66A_7CED1A[sp92];
                func_80356BD8_768288(&D_01000CA0, &D_01002100, sp94);
                gSPDisplayList(D_801D9E88++, D_010037F0_3D0C0);
                func_802C78B0_6D8F60(1U, 0x14U, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (s16) (s32) D_803F2ED0, (s16) 0, (u8) 0, (u8) 0, &D_040046D0_CC100);
                func_80356BD8_768288(&D_01000CA0, &D_01002100, (s16) sp92);
                func_802C78B0_6D8F60(1U, 0x14U, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (D_803F2EC8 * 0x3A) >> 6, (s16) (s32) D_803F2ED0, (s16) 0, (u8) 0, (u8) 0, &D_040046F0_CC120);
                gSPDisplayList(D_801D9E88++, D_01003840_3D110);
            }
            gSPPopMatrix(D_801D9E88++, G_MTX_MODELVIEW);
        }
        func_8035D6A0_76ED50();
    } else {
        func_8035D6D0_76ED80();
    }
    if ((spAE == 0) || (spAE == 2)) {
        func_8034BD20_75D3D0(D_803D552C->xPos.h, D_803D552C->zPos.h, (s16) (D_803D552C->yPos.h + D_803D5524->unkBA), (s16) ((D_803D552C->unk302 - sp9A) & 0xFF), (s32) &D_01033190, (s16) 0x25, (s16) 9, (s16) 0x9B, 0, 0, 0, (s16) 0, (s16) (s32) D_803D5538);
    }
    if (spAE == 0) {
        func_803034D0_714B80(D_803D552C, 0x30C, 0, 1);
        func_80303990_715040(D_803D552C, 0x20U, 0x21U, 0x13U, (u16) 0x14, (u16) 0x1F4, (u16) 0);
        func_80303D50_715400(D_803D552C, 3U);
    } else {
        func_80303D00_7153B0(D_803D552C, 0x492U, 0x1F4U);
    }
    if (D_803D5538 == 0) {
        // temp_v0_19 = D_803D552C;
        // temp_v1_12 = D_803D552C->unk2EC;
        if (D_803D552C->unk2EC <= 0) {
            if (D_803D552C->unk365 == 0x2A) {
                D_803D552C->unk365 = 0x2B;
                D_803D552C->unk32A = D_803D5544;
            }
        } else {
            D_803D552C->unk2EC = D_803D552C->unk2EC - 1;
        }
    }
}
#else
#pragma GLOBAL_ASM("asm/nonmatchings/sssv/animals/fox/func_802E7394_6F8A44.s")
#endif

void func_802E84E0_6F9B90(void) {
    func_8037D994_78F044(16);
}

// fire_fox_fire_missile2 ?
void func_802E8500_6F9BB0(void) {
    Animal *animal = func_8037E9AC_79005C();
    if (animal != NULL) {
        play_sound_effect_at_location(2, 0x3700, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);
    }
    // scale missile to zero
    func_8037FBBC_79126C();
    // fire missile
    fire_homing_missile(
        D_803D5530->xPos.h,
        D_803D5530->zPos.h,
        D_803D5530->yPos.h - D_803D5530->unk42,
        0x161,
        D_803D552C->unk302*360 >> 8,
        animal,
        1,
        16,
        0.5f,
        0xC8,
        0x60,
        D_803D5530->xVelocity.h,
        D_803D5530->zVelocity.h,
        D_803D5530->yVelocity.h,
        D_803D5530);
    play_sound_effect_at_location(2, 0x3700, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);
}

void func_802E864C_6F9CFC(void) {
    if (D_803D552C->unk365 != ATTACK_FOX_DASH) {
        D_803D552C->unk32A = D_803D5544;
        D_803D552C->unk365 = ATTACK_FOX_DASH;
        func_8033F2EC_75099C();
        func_8033F294_750944(2);
    } else {
        D_803D5528->skillAEnergy[0] += D_803D5524->unkDA[0];
    }
}

void func_802E86C8_6F9D78(void) {
    if (D_803D552C->unk365 == ATTACK_FOX_3) {
        D_803D552C->unk365 = ATTACK_FOX_TAIL;
    } else if (D_803D552C->unk365 != ATTACK_FOX_TAIL) {
        D_803D552C->unk32A = D_803D5544;
        D_803D552C->unk365 = ATTACK_FOX_TAIL;
        play_sound_effect_at_location(0, 0x5000, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);
    }
}

// racing fox
void func_802E8760_6F9E10(void) {
    if (((D_803D5544 - D_803D552C->unk32A) >= 13) && (D_803D552C->unk365 == ATTACK_FOX_TAIL)) {
        D_803D552C->unk365 = ATTACK_FOX_3;
        D_803D552C->unk32A = D_803D5544;
    }
}

void fire_fox_fire_missile(Animal *animal) {
    play_sound_effect_at_location(2, 0x3700, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);
    // scale missile to zero
    func_8037FBBC_79126C();
    // fire missile
    fire_homing_missile(
        D_803D5530->xPos.h,
        D_803D5530->zPos.h,
        D_803D5530->yPos.h - D_803D5530->unk42,
        353,
        D_803D552C->unk302 * 360 >> 8,
        animal,
        2,
        16,
        0.5f,
        200,
        96,
        D_803D5530->xVelocity.h,
        D_803D5530->zVelocity.h,
        D_803D5530->yVelocity.h,
        D_803D5530);
}

// fox_tail_attack
void func_802E88C0_6F9F70(s16 arg0) {
    if (D_803D552C->unk365 == ATTACK_FOX_TAIL) {
        D_803D552C->unk2EC = MAX(D_803D552C->unk2EC, arg0);
    } else if (D_803D552C->unk365 == ATTACK_FOX_3) {
        D_803D552C->unk2EC = arg0;
        D_803D552C->unk365 = ATTACK_FOX_TAIL;
        D_803D552C->unk32A -= 8;
    } else {
        D_803D552C->unk2EC = arg0;
        D_803D552C->unk32A = D_803D5544;
        D_803D552C->unk365 = ATTACK_FOX_TAIL;
        play_sound_effect_at_location(0, 0x5000, 0, D_803D5530->xPos.h, D_803D5530->zPos.h, D_803D5530->yPos.h, 1.0f);
    }
}

void fox_warp(void) {
    if (D_803D552C->unk365 != ATTACK_FOX_DASH) {
        D_803D552C->unk32A = D_803D5544;
        D_803D552C->unk365 = ATTACK_FOX_DASH;
    }
}
