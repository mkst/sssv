#include <ultra64.h>
#include "common.h"


extern s32 D_803A6070_7B7720;
extern s32 D_803A6078_7B7728;
extern s32 D_803A607C_7B772C;
extern s32 D_803A608C_7B773C;
extern s32 D_803A6098_7B7748;
extern s32 D_803A60B0_7B7760;
extern s32 D_803A60C4_7B7774;
extern s32 D_803A60DC_7B778C;
extern s32 D_803A60F0_7B77A0;
extern s32 D_803A60F8_7B77A8;
extern s32 D_803A60FC_7B77AC;
extern s32 D_803A610C_7B77BC;
extern s32 D_803A6118_7B77C8;
extern s32 D_803A6120_7B77D0;
extern s32 D_803A6124_7B77D4;
extern s32 D_803A6134_7B77E4;
extern s32 D_803A6138_7B77E8;
extern s32 D_803A6160_7B7810;
extern s32 D_803A6174_7B7824;
extern s32 D_803A618C_7B783C;
extern s32 D_803A61A0_7B7850;
extern s32 D_803A61B8_7B7868;
extern s32 D_803A61CC_7B787C;
extern s32 D_803A61DC_7B788C;
extern s32 D_803A61E8_7B7898;
extern s32 D_803A6208_7B78B8;
extern s32 D_803A6224_7B78D4;
extern s32 D_803A6234_7B78E4;
extern s32 D_803A6240_7B78F0;
extern s32 D_803A6258_7B7908;
extern s32 D_803A6264_7B7914;
extern s32 D_803A6274_7B7924;
extern s32 D_803A6280_7B7930;
extern s32 D_803A6288_7B7938;
extern s32 D_803A628C_7B793C;
extern s32 D_803A629C_7B794C;
extern s32 D_803A62A0_7B7950;
extern s32 D_803A62B0_7B7960;
extern s32 D_803A62BC_7B796C;
extern s32 D_803A62CC_7B797C;
extern s32 D_803A62D8_7B7988;
extern s32 D_803A62F0_7B79A0;
extern s32 D_803A62FC_7B79AC;
extern s32 D_803A6304_7B79B4;
extern s32 D_803A6308_7B79B8;
extern s32 D_803A6310_7B79C0;
extern s32 D_803A6314_7B79C4;
extern s32 D_803A631C_7B79CC;
extern s32 D_803A6320_7B79D0;
extern s32 D_803A6330_7B79E0;
extern s32 D_803A633C_7B79EC;
extern s32 D_803A634C_7B79FC;
extern s32 D_803A6358_7B7A08;
extern s32 D_803A6360_7B7A10;
extern s32 D_803A6364_7B7A14;
extern s32 D_803A6374_7B7A24;
extern s32 D_803A6378_7B7A28;
extern s32 D_803A6380_7B7A30;
extern s32 D_803A6384_7B7A34;
extern s32 D_803A6394_7B7A44;
extern s32 D_803A6398_7B7A48;
extern s32 D_803A63A0_7B7A50;
extern s32 D_803A63A4_7B7A54;
extern s32 D_803A63AC_7B7A5C;

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_80327BE0_739290.s")

void func_80327DA0_739450(void) {
}

void func_80327DA8_739458(void) {
    switch (D_803E9820 - 1) {
    case 0:
        D_803E9828 = &D_803A6070_7B7720;
        D_803E982C = &D_803A6078_7B7728;
        break;
    case 1:
        D_803E9828 = &D_803A607C_7B772C;
        D_803E982C = &D_803A608C_7B773C;
        break;
    case 2:
        D_803E9828 = &D_803A6098_7B7748;
        D_803E982C = &D_803A60B0_7B7760;
        break;
    case 3:
        D_803E9828 = &D_803A60C4_7B7774;
        D_803E982C = &D_803A60DC_7B778C;
        break;
    case 4:
        D_803E9828 = &D_803A60F0_7B77A0;
        D_803E982C = &D_803A60F8_7B77A8;
        break;
    case 5:
        D_803E9828 = &D_803A60FC_7B77AC;
        D_803E982C = &D_803A610C_7B77BC;
        break;
    case 6:
        D_803E9828 = &D_803A6118_7B77C8;
        D_803E982C = &D_803A6120_7B77D0;
        break;
    case 7:
        D_803E9828 = &D_803A6124_7B77D4;
        D_803E982C = &D_803A6134_7B77E4;
        break;
    case 8:
        D_803E9828 = &D_803A6138_7B77E8;
        D_803E982C = &D_803A6160_7B7810;
        break;
    case 9:
        D_803E9828 = &D_803A6174_7B7824;
        D_803E982C = &D_803A618C_7B783C;
        break;
    case 10:
        D_803E9828 = &D_803A61A0_7B7850;
        D_803E982C = &D_803A61B8_7B7868;
        break;
    case 11:
        D_803E9828 = &D_803A61CC_7B787C;
        D_803E982C = &D_803A61DC_7B788C;
        break;
    case 12:
        D_803E9828 = &D_803A61E8_7B7898;
        D_803E982C = &D_803A6208_7B78B8;
        break;
    case 13:
        D_803E9828 = &D_803A6224_7B78D4;
        D_803E982C = &D_803A6234_7B78E4;
        break;
    case 14:
        D_803E9828 = &D_803A6240_7B78F0;
        D_803E982C = &D_803A6258_7B7908;
        break;
    case 15:
        D_803E9828 = &D_803A6264_7B7914;
        D_803E982C = &D_803A6274_7B7924;
        break;
    case 16:
        D_803E9828 = &D_803A6280_7B7930;
        D_803E982C = &D_803A6288_7B7938;
        break;
    case 17:
        D_803E9828 = &D_803A628C_7B793C;
        D_803E982C = &D_803A629C_7B794C;
        break;
    case 18:
        D_803E9828 = &D_803A62A0_7B7950;
        D_803E982C = &D_803A62B0_7B7960;
        break;
    case 19:
        D_803E9828 = &D_803A62BC_7B796C;
        D_803E982C = &D_803A62CC_7B797C;
        break;
    case 20:
        D_803E9828 = &D_803A62D8_7B7988;
        D_803E982C = &D_803A62F0_7B79A0;
        break;
    case 21:
        D_803E9828 = &D_803A62FC_7B79AC;
        D_803E982C = &D_803A6304_7B79B4;
        break;
    case 22:
        D_803E9828 = &D_803A6308_7B79B8;
        D_803E982C = &D_803A6310_7B79C0;
        break;
    case 23:
        D_803E9828 = &D_803A6314_7B79C4;
        D_803E982C = &D_803A631C_7B79CC;
        break;
    case 24:
        D_803E9828 = &D_803A6320_7B79D0;
        D_803E982C = &D_803A6330_7B79E0;
        break;
    case 25:
        D_803E9828 = &D_803A633C_7B79EC;
        D_803E982C = &D_803A634C_7B79FC;
        break;
    case 26:
        D_803E9828 = &D_803A6358_7B7A08;
        D_803E982C = &D_803A6360_7B7A10;
        break;
    case 27:
        D_803E9828 = &D_803A6364_7B7A14;
        D_803E982C = &D_803A6374_7B7A24;
        break;
    case 28:
        D_803E9828 = &D_803A6378_7B7A28;
        D_803E982C = &D_803A6380_7B7A30;
        break;
    case 29:
        D_803E9828 = &D_803A6384_7B7A34;
        D_803E982C = &D_803A6394_7B7A44;
        break;
    case 30:
        D_803E9828 = &D_803A6398_7B7A48;
        D_803E982C = &D_803A63A0_7B7A50;
        break;
    case 31:
        D_803E9828 = &D_803A63A4_7B7A54;
        D_803E982C = &D_803A63AC_7B7A5C;
        break;
    }
}

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_80328258_739908.s")

void func_803283DC_739A8C(void) {
    func_803284C4_739B74();

    if (D_803D5524->unk9C != ELEPHANT) {
        D_803D552C->unk308 = 0;
    }
    D_803D552C->unk30A = 0;
    D_803D552C->unk30C = 0;
    D_803D552C->unk30E = 0;
    switch (D_803E9824) {
    case 5:
        D_803D552C->unk302 = 0;
        D_803D5530->unk28 = 0;
        D_803D5530->yPos += 35;
        break;
    case 6:
        break;
    case 7:
        D_803D552C->unk302 = 0;
        D_803D5530->unk28 = 0;
        D_803D5530->yPos += 35;
        break;
    default:
    case 8:
    case 27:
        break;
    }
}

struct025* func_803284C4_739B74(void) {
    struct035 *temp_v1;
    struct025 *temp_v0;

    temp_v1 = D_803D5524;
    temp_v0 = &D_803F28E0[D_803F2A98];
    temp_v0->unk4E = temp_v1->unkCA;
    temp_v0->unk54 = temp_v1->unkD0;
    temp_v0->unk56 = temp_v1->unkD2;
    temp_v0->unk58 = temp_v1->unkCC;
    temp_v0->unk60 = temp_v1->unkCE;
    return temp_v0;
}

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_80328520_739BD0.s")

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_80328918_739FC8.s")

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_80328ACC_73A17C.s")

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_80329BAC_73B25C.s")

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_80329F44_73B5F4.s")

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_8032A164_73B814.s")

#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_8032A710_73BDC0.s")
// miles away
// void func_8032A710_73BDC0(void) {
//     s16 temp_a0;
//     s16 temp_t0;
//     s16 temp_v0_6;
//     s16 temp_v1;
//     s16 temp_v1_2;
//     s16 temp_v1_3;
//     Animal *temp_a1;
//     struct036 *temp_a2;
//     void *temp_t7;
//     void *temp_t9;
//     void *temp_t9_2;
//     void *temp_v0;
//     Animal *temp_v0_2;
//     s8 *temp_v0_7;
//     Animal *temp_v0_8;
//     s16 phi_v0;
//
//     // temp_v0 = D_803D552C;
//     temp_t0 = D_803D552C->unk30E;
//     D_803D552C->unk320 = 0;
//     func_8032AA94_73C144();
//     temp_a2 = &D_801D9ED8 + temp_t0; // + ( * 8);
//     temp_v0_2 = temp_a2->animal;
//     temp_v1 = temp_v0_2->health;
//     temp_v0_2->health = (s16) D_801D9ED8.animal->health;
//     D_801D9ED8.animal->health = temp_v1;
//     temp_v1_2 = temp_v0_2->skillAEnergy;
//     temp_v0_2->skillAEnergy = (s16) D_801D9ED8.animal->skillAEnergy;
//     D_801D9ED8.animal->skillAEnergy = temp_v1_2;
//     temp_v1_3 = temp_v0_2->skillBEnergy;
//     temp_v0_2->skillBEnergy = (s16) D_801D9ED8.animal->skillBEnergy;
//     D_801D9ED8.animal->skillBEnergy = temp_v1_3;
//     D_801D9ED8.animal->unk4A = (u8)0;
//     temp_a2->animal->unk4A = (u8)0;
//     temp_a1 = D_801D9ED8.animal;
//     temp_a1->unk4F = (u8) (((((u32) (temp_a2->animal->unk4C << 0x1A) >> 0x1F) << 5) & 0x20) | (temp_a1->unk4F & 0xFFDF));
//     temp_v0_2 = temp_a2->animal;
//     temp_v0_2->unk4F = (u8) (((((u32) (temp_a1->unk4C << 0x1A) >> 0x1F) << 5) & 0x20) | (temp_v0_2->unk4F & 0xFFDF));
//     D_803D5520 = &D_801DDD88;
//     D_803D5524 = (s32) D_801D9ED8.unk3EB0;
//     temp_t7 = D_801D9ED8.animal;
//     D_803D5528 = temp_t7;
//     D_803D552C = temp_t7;
//     D_803D5530 = temp_t7;
//     if (gCurrentAnimalIndex == 0) {
//         D_803D5538 = (u8)1;
//     } else {
//         D_803D5538 = (u8)0;
//     }
//     D_803D553C = (u16)0;
//     D_803D553A = (u16)0;
//     D_803D5520 = &D_801DD800;
//     D_803D5530->unk16C = &D_801DD800;
//     gCurrentAnimalIndex = temp_t0;
//     D_803D5520 = (void *) temp_a2->unk3EB0;
//     D_803D5524 = (void *) temp_a2->unk3EB0;
//     temp_t9 = temp_a2->animal;
//     D_803D5528 = temp_t9;
//     D_803D552C = temp_t9;
//     D_803D5530 = temp_t9;
//     if (temp_t0 == gCurrentAnimalIndex) {
//         D_803D5538 = (u8)1;
//     } else {
//         D_803D5538 = (u8)0;
//     }
//     D_803D553C = temp_t0;
//     D_803D553A = (u16)0;
//     D_803D552C->unk366 = (u8)1;
//     D_803D552C->unk328 = (u16) D_803D5544;
//     D_803D552C->unk36A = (u8)2;
//     D_803D5530->unk163 = (u8) D_801D9ED8.animal->unk163;
//     D_803D5530->unk18C = (u8) D_801D9ED8.animal->unk18C;
//     phi_v0 = (u16)0;
// loop_7:
//     temp_v0_6 = phi_v0 + 1;
//     // (D_803D5530 + phi_v0)->unk18D = (u8) (D_801D9ED8.animal + phi_v0)->unk18D;
//     phi_v0 = temp_v0_6;
//     if ((s32) temp_v0_6 < 4) {
//         goto loop_7;
//     }
//     D_803D5530->unk18C = (u8) D_801D9ED8.animal->unk18C;
//     D_803E9824 = (u16) temp_a2->unk3EB0->unk9C;
//     temp_a0 = (s16) D_803E9824;
//     temp_v0_7 = (temp_a0 * 2) + &D_803A63B0_7B7A60;
//     D_803E9820 = temp_v0_7[0];
//     D_803E9822 = temp_v0_7[1];
//     check_and_set_species_encountered(temp_a0); //, &D_803D5538, temp_a2, (u8)1);
//     func_80327DA8_739458();
//     func_803283DC_739A8C();
//     func_802B2EA8_6C4558();
//     func_802C9BA4_6DB254(D_803D5530);
//     D_803D5520 = &D_801DDD88;
//     D_803D5524 = (s32) D_801D9ED8.unk3EB0;
//     temp_t9_2 = D_801D9ED8.animal;
//     D_803D5528 = temp_t9_2;
//     D_803D552C = temp_t9_2;
//     D_803D5530 = temp_t9_2;
//     if (gCurrentAnimalIndex == 0) {
//         D_803D5538 = (u8)1;
//     } else {
//         D_803D5538 = (u8)0;
//     }
//     D_803D553C = (u16)0;
//     D_803D553A = (u16)0;
//     play_sound_effect_at_location(SFX_UNKNOWN_40, 0x5000, 0, D_803D5530->xPos, D_803D5530->zPos,  D_803D5530->yPos, 1.0f);
// }

void func_8032AA94_73C144(void) {
    func_80321920_732FD0(D_803D552C->unk320, 0, 0);
    D_803D552C->unk320 = 0;
    if (D_803D5530->state == 0xDD) {
        func_802E4AB8_6F6168();
    }
}

void load_animal(s16 arg0) {
    D_803D5530->unk16C = D_803D5520->unk0 = &D_801D9ED8.unk0[arg0];
    D_803E9824 = arg0;

    D_803E9820 = D_803A63B0_7B7A60[D_803E9824].unk0;
    D_803E9822 = D_803A63B0_7B7A60[D_803E9824].unk1;
    func_80327DA8_739458();
    D_803D5530->unk46 = D_803D5530->unk16C->unk7C;
    func_802C9BA4_6DB254(D_803D5530);
    D_803D5524 = D_803D5520->unk0;
}

// load animal info screen if first time player is transferring into an animal
void check_and_set_species_encountered(s16 animal_id) {
    if ((D_803E4D28 & 8) == 0) {
        // if first time visiting then load TV info screen
        if (((D_8023F260.speciesSeen[(s8) (animal_id >> 3)] & (1 << (s8)(animal_id % 7))) == 0) && (D_803E1BC0 == 0)) {
            D_8023F260.speciesSeen[(s8) (animal_id >> 3)] |= (1 << (s8)(animal_id % 7));
            func_8038F694_7A0D44();
        }
    }
}

void set_species_as_encountered(s16 animal_id) {
    D_8023F260.speciesSeen[(s8) (animal_id >> 3)] |= (1 << (s8) (animal_id % 7));
}

// funny effect 1: weird continuous growing/shrinking
#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_8032AC98_73C348.s")
// void func_8032AC98_73C348(void) {
//     Animal *temp_a0;
//     struct035 *temp_a1;
//     struct036 *temp_v1;
//     s16 i;
//
//     for (i = 0; i < D_803D553E; i++) {
//         temp_v1 = &D_801D9ED8[i];
//         temp_a0 = temp_v1->animal;
//         if (temp_a0 != NULL) {
//             temp_a1 = temp_v1->unk3EB0;
//             if ((temp_a1->unk9C != EVO_GLITCHY) && (temp_a0->unk366 != 6)) {
//                 D_803D5520 = &temp_v1->unk3EB0;
//                 D_803D5524 = temp_a1;
//                 D_803D552C = temp_a0;
//                 D_803D5528 = temp_a0;
//                 D_803D5530 = temp_a0;
//                 if (gCurrentAnimalIndex == i) {
//                     D_803D5538 = 1;
//                 } else {
//                     D_803D5538 = 0;
//                 }
//                 D_803D553C = i;
//                 D_803D553A = 0;
//                 func_80380620_791CD0(D_803D552C, 2000, 20, 512, 0);
//                 D_803D552C->unk348 = 512;
//                 D_803D552C->unk34A = 512;
//                 D_803D552C->unk36B = 100;
//             }
//         }
//   }
//     if ((D_803A6CE4 & (4 | 2)) == 0) {
//         D_803A6CE4 |= 2;
//     } else {
//         D_803A6CE4 |= 4;
//     }
// }

// funny effect 2: infinite a+b energy? flips camera
void func_8032AE34_73C4E4(void) {
    struct035 *tmp;
    s16 i;

    for (i = 0; i < AID_MAX_ANIMALS; i++) {
        tmp = &D_801D9ED8.unk0[i];
        tmp->unkDA[0] = 1;
        tmp->unkE0[0] = 1;
    }
    if ((D_803A6CE4 & 5) == 0) {
        D_803A6CE4 |= 1;
    } else {
        D_803A6CE4 |= 4;
    }
}

// funny effect 3: tiny body / big head
void func_8032AEA0_73C550(void) {
    struct035 *tmp;
    s16 i;

    if ((D_803A6CE4 & 8) != 0) {
        func_803421E0_753890(100);
        return;
    }

    for (i = 0; i < AID_MAX_ANIMALS; i++) {
        tmp = &D_801D9ED8.unk0[i];
        tmp->unkC8 = tmp->unkC8 / 3;
        tmp->unkA4 = tmp->unkA4 / 3;
        tmp->unkAA = tmp->unkAA / 3;
        tmp->unkAC = tmp->unkAC / 3;
        tmp->unkC2 = tmp->unkC2 / 3;
        tmp->unkC4 = tmp->unkC4 / 3;
        // different scaling factor?
        tmp->unkD0 = tmp->unkD0 / 2;
        tmp->unkD2 = tmp->unkD2 / 2;
    }

    D_803A6CE4 |= (8 | 4);
}

// funny effect 4: turns bear into unibear
#pragma GLOBAL_ASM("asm/nonmatchings/overlay2_739290/func_8032B084_73C734.s")
// more of the same nonsense...
// void func_8032B084_73C734(void) {
//     s16 temp_a1;
//     u16 temp_v1;
//     Animal *temp_a0;
//     struct050 *temp_v0;
//
//     temp_a1 = gCurrentAnimalIndex;
//     temp_v0 = &D_801D9ED8.unk0[gCurrentAnimalIndex];
//     temp_a0 = temp_v0->animal;
//     temp_v1 = temp_a0->unk16C->unk0;
//     if (temp_v1 == 278) {
//         D_803D5520->unk0 = &D_801D9ED8.animal;
//         D_803D5524 = D_801D9ED8.animal;
//         D_803D5528 = temp_a0;
//         D_803D552C = temp_a0;
//         D_803D5530 = temp_a0;
//         D_803D5538 = 1;
//         D_803D553C = temp_a1;
//         D_803D553A = 0;
//         load_animal(MYSTERY_BEAR);
//         func_802B2EA8_6C4558();
//         D_803A6CE4 |= 4;
//     } else if (temp_v1 == 280) {
//         // D_803D5520->unk0 = temp_v0->unk3EB0;
//         // D_803D5524 = &temp_v0->unk3EB0;
//         D_803D5528 = temp_a0;
//         D_803D552C = temp_a0;
//         D_803D5530 = temp_a0;
//         D_803D5538 = 1;
//         D_803D553C = temp_a1;
//         D_803D553A = 0;
//         load_animal(BEAR);
//         func_802B2EA8_6C4558();
//         D_803A6CE4 &= 0xFFFB;
//     } else {
//         func_803421E0_753890(100);
//     }
// }

// cheat 5: nothing?
void func_8032B1C8_73C878(void) {
    D_803A6CE4 &= 0xFFF8;
}
